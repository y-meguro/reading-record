{"version":3,"sources":["../src/2.2.2.js"],"names":["matchToReplace","text","pattern","matchFn","match","exec","_num2ja","num","opt","sign","zero","point","zero2nine","ten2thou","suffices","replace","sig","RegExp","$1","int","$2","fract","$3","seisuu","shins","i","length","push","substring","suffix","shin","sens","keta","digits","split","reverse","j","digit","flg","k","suuji","result","reporter","context","Syntax","RuleError","report","fixer","getSource","Str","node","toNumber","matchedString","index","expected","all","ruleError","fix","replaceTextRange","toKanNumber","with_arabic","ignoreWhenMatched","ignorePattern","test","module","exports","linter"],"mappings":"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","sourcesContent":["// LICENSE : MIT\n\"use strict\";\nimport { isUserWrittenNode } from \"./util/node-util\";\nimport ja2num from \"japanese-numerals-to-number\";\n\nfunction matchToReplace(text, pattern, matchFn) {\n    var match = pattern.exec(text);\n    if (match) {\n        return matchFn(text, pattern, match);\n    }\n    return null;\n}\n\n// http://www.drk7.jp/MT/archives/001587.html\nfunction _num2ja(num, opt) {\n    var sign = {\n        \"+\": \"\",\n        \"-\": \"−\"\n    };\n    var zero = \"零\";\n    var point = \"点\";\n    var zero2nine = [\"〇\", \"一\", \"二\", \"三\", \"四\", \"五\", \"六\", \"七\", \"八\", \"九\"];\n    var ten2thou = [\"\", \"十\", \"百\", \"千\"];\n    var suffices = [\n        \"\",\n        \"万\",\n        \"億\",\n        \"兆\",\n        \"京\",\n        \"垓\",\n        \"禾予\",\n        \"穣\",\n        \"溝\",\n        \"澗\",\n        \"正\",\n        \"載,\",\n        \"極\",\n        \"恒河沙\",\n        \"阿僧祇\",\n        \"那由他\",\n        \"不可思議\",\n        \"無量大数\"\n    ];\n\n    num = num.replace(/,/g, \"\");\n    num.match(/([+-])?(\\d+)(?:\\.(\\d+))?/i);\n    var sig = RegExp.$1;\n    var int = RegExp.$2;\n    var fract = RegExp.$3;\n    var seisuu = \"\";\n    var shins = [];\n\n    for (let i = int.length; i > 0; i -= 4) {\n        shins.push(int.substring(i, i - 4));\n    }\n    if (shins.length >= 18) {\n        return suffices[17];\n    }\n\n    var suffix = 0;\n    for (let i = 0; i < shins.length; i++) {\n        var shin = shins[i];\n        if (shin == \"0000\") {\n            suffix++;\n            continue;\n        }\n        var sens = \"\";\n        var keta = 0;\n        var digits = shin.split(\"\").reverse();\n        for (var j = 0; j < digits.length; j++) {\n            var digit = digits[j];\n\n            if (opt[\"fixed4\"] || opt[\"with_arabic\"]) {\n                if (opt[\"with_arabic\"]) {\n                    var flg = 0;\n                    // 余分な 0 を削除する\n                    if (digit == \"0\") {\n                        for (var k = j + 1; k < digits.length; k++) {\n                            flg += digits[k] == \"0\" ? 0 : 1;\n                        }\n                        if (flg == 0) {\n                            digit = \"\";\n                        }\n                    }\n                    sens = digit + sens;\n                } else {\n                    sens = zero2nine[digit] + sens;\n                }\n            } else {\n                var suuji = digit == 1 && !opt[\"p_one\"] && keta > 0 ? \"\" : zero2nine[digit];\n                if (digit != 0) {\n                    sens = suuji + ten2thou[keta] + sens;\n                }\n            }\n            keta++;\n        }\n        seisuu = sens + suffices[suffix++] + seisuu;\n    }\n    var result = (sign[sig] || \"\") + seisuu;\n    result = result || zero;\n    if (fract) {\n        result = result + point + fract;\n    }\n    return result;\n}\n\nfunction reporter(context) {\n    let { Syntax, RuleError, report, fixer, getSource } = context;\n    return {\n        [Syntax.Str](node) {\n            if (!isUserWrittenNode(node, context)) {\n                return;\n            }\n            const text = getSource(node);\n            // 漢数字 -> 算用数字\n            const toNumber = (text, pattern, match) => {\n                const matchedString = match[0];\n                const index = match.index;\n                const expected = matchedString.replace(pattern, function(all, match) {\n                    return all.replace(match, ja2num(match));\n                });\n                const ruleError = new RuleError(\n                    `${matchedString} => ${expected}\n数量を表現し、数を数えられるものは算用数字を使用します。任意の数に置き換えても通用する語句がこれに該当します。`,\n                    {\n                        index: index,\n                        fix: fixer.replaceTextRange([index, index + matchedString.length], expected)\n                    }\n                );\n                report(node, ruleError);\n            };\n\n            /**\n             * 算用数字 -> 漢数字\n             * @param {string} text\n             * @param {RegExp} pattern\n             * @param {*[]} match\n             */\n            const toKanNumber = (text, pattern, match) => {\n                const matchedString = match[0];\n                const expected = matchedString.replace(pattern, function(all, match) {\n                    return all.replace(match, _num2ja(match, { with_arabic: false }));\n                });\n                const index = match.index;\n                report(\n                    node,\n                    new RuleError(\n                        `${matchedString} => ${expected}\n慣用的表現、熟語、概数、固有名詞、副詞など、漢数字を使用することが一般的な語句では漢数字を使います。`,\n                        {\n                            index: index,\n                            fix: fixer.replaceTextRange([index, index + matchedString.length], expected)\n                        }\n                    )\n                );\n            };\n\n            // ignorePatternにマッチしたらmatchFnを呼ばないようにする(エラーを無視する)\n            const ignoreWhenMatched = (ignorePattern, matchFn) => {\n                return (text, pattern, match) => {\n                    if (ignorePattern.test(text)) {\n                        return null;\n                    } else {\n                        return matchFn(text, pattern, match);\n                    }\n                };\n            };\n\n            // ＊数えられる数字は算用数字を使う\n            // 数十万、数百億にマッチしないように\"数\"という文字から始まるものは除外\n            // https://github.com/textlint-ja/textlint-rule-preset-jtf-style/pull/23\n            matchToReplace(\n                text,\n                /([一二三四五六七八九十壱弐参拾百〇]+)[兆億万]/g,\n                ignoreWhenMatched(/(数|何)([一二三四五六七八九十壱弐参拾百〇]+)[兆億万]/g, toNumber)\n            );\n            matchToReplace(text, /([一二三四五六七八九十壱弐参拾百〇]+)つ/g, toNumber);\n            matchToReplace(text, /([一二三四五六七八九十壱弐参拾百〇]+)回/g, toNumber);\n            matchToReplace(text, /([一二三四五六七八九十壱弐参拾百〇]+)か月/g, toNumber);\n            matchToReplace(text, /([一二三四五六七八九十壱弐参拾百〇]+)番目/g, toNumber);\n            matchToReplace(text, /([一二三四五六七八九十壱弐参拾百〇]+)進法/g, toNumber);\n            matchToReplace(text, /([一二三四五六七八九十壱弐参拾百〇]+)次元/g, toNumber);\n            matchToReplace(text, /第([一二三四五六七八九十壱弐参拾百〇]+)章/g, toNumber);\n            matchToReplace(text, /第([一二三四五六七八九十壱弐参拾百〇]+)節/g, toNumber);\n            // ＊漢数字を使う\n            // 慣用的表現、熟語、概数、固有名詞、副詞など、漢数字を使用することが一般的な語句では漢数字を使います。\n            matchToReplace(text, /世界(1)/g, toKanNumber);\n            matchToReplace(text, /(1)時的/g, toKanNumber);\n            matchToReplace(text, /(1)部分/g, toKanNumber);\n            matchToReplace(text, /第(3)者/g, toKanNumber);\n            // 1種 -> 一種: 11種類などにはマッチしない\n            matchToReplace(text, /[^\\d](1)種(?!類)/g, toKanNumber);\n            matchToReplace(text, /(1)部の/g, toKanNumber);\n            matchToReplace(text, /(1)番に/g, toKanNumber);\n            matchToReplace(text, /数([0-9]+)倍/g, toKanNumber);\n            matchToReplace(text, /数([0-9]+)[兆億万]/g, toKanNumber);\n            matchToReplace(text, /数([0-9]+)年/g, toKanNumber);\n            matchToReplace(text, /([0-9]+)次関数/g, toKanNumber);\n            matchToReplace(text, /(5)大陸/g, toKanNumber);\n        }\n    };\n}\n\n// 2.2.2. 算用数字と漢数字の使い分け\nmodule.exports = {\n    linter: reporter,\n    fixer: reporter\n};\n"],"file":"2.2.2.js"}